# Generated by Django 6.0 on 2025-12-17 05:01

import django.db.models.deletion
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Category',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=64)),
                ('slug', models.SlugField(unique=True)),
                ('description', models.TextField(blank=True)),
                ('icon', models.CharField(blank=True, help_text='CSS icon class name', max_length=50)),
                ('display_order', models.IntegerField(default=0)),
            ],
            options={
                'verbose_name_plural': 'Categories',
                'ordering': ['display_order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='Event',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=200)),
                ('slug', models.SlugField(unique=True)),
                ('description', models.TextField()),
                ('event_type', models.CharField(choices=[('binary', 'Binary (Yes/No)'), ('multi', 'Multi-Outcome')], default='binary', max_length=10)),
                ('resolution_source', models.CharField(help_text='Source used to determine outcome (e.g., official website, news agency)', max_length=500)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('trading_starts', models.DateTimeField()),
                ('trading_ends', models.DateTimeField()),
                ('resolution_date', models.DateTimeField(blank=True, help_text='Expected date when event outcome will be known', null=True)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('active', 'Active'), ('closed', 'Closed (Trading Halted)'), ('settled', 'Settled'), ('cancelled', 'Cancelled')], default='draft', max_length=10)),
                ('category', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='events', to='predictions.category')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_events', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-trading_starts'],
            },
        ),
        migrations.CreateModel(
            name='Market',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(help_text="The specific question, e.g., 'Will Biden win?'", max_length=200)),
                ('slug', models.SlugField()),
                ('description', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('active', 'Active'), ('halted', 'Trading Halted'), ('settled_yes', 'Settled - Yes Won'), ('settled_no', 'Settled - No Won'), ('cancelled', 'Cancelled')], default='active', max_length=15)),
                ('last_yes_price', models.IntegerField(default=50, help_text='Last traded YES price (1-99 cents)')),
                ('last_no_price', models.IntegerField(default=50, help_text='Last traded NO price (1-99 cents)')),
                ('best_yes_bid', models.IntegerField(blank=True, null=True)),
                ('best_yes_ask', models.IntegerField(blank=True, null=True)),
                ('best_no_bid', models.IntegerField(blank=True, null=True)),
                ('best_no_ask', models.IntegerField(blank=True, null=True)),
                ('total_volume', models.IntegerField(default=0, help_text='Total contracts traded')),
                ('volume_24h', models.IntegerField(default=0, help_text='Contracts traded in last 24h')),
                ('is_mutually_exclusive', models.BooleanField(default=True, help_text='If true, only one market in the event can settle YES')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('event', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='markets', to='predictions.event')),
            ],
            options={
                'ordering': ['event', 'title'],
            },
        ),
        migrations.CreateModel(
            name='Order',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('side', models.CharField(choices=[('buy', 'Buy'), ('sell', 'Sell')], max_length=4)),
                ('contract_type', models.CharField(choices=[('yes', 'Yes'), ('no', 'No')], max_length=3)),
                ('price', models.IntegerField(help_text='Price in cents (1-99)')),
                ('quantity', models.IntegerField(help_text='Number of contracts')),
                ('filled_quantity', models.IntegerField(default=0)),
                ('status', models.CharField(choices=[('open', 'Open'), ('partial', 'Partially Filled'), ('filled', 'Filled'), ('cancelled', 'Cancelled'), ('expired', 'Expired')], default='open', max_length=10)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('market', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='orders', to='predictions.market')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='prediction_orders', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Position',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('yes_quantity', models.IntegerField(default=0)),
                ('no_quantity', models.IntegerField(default=0)),
                ('yes_avg_cost', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('no_avg_cost', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('realized_pnl', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('market', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='positions', to='predictions.market')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='positions', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='Trade',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('contract_type', models.CharField(choices=[('yes', 'Yes'), ('no', 'No')], max_length=3)),
                ('price', models.IntegerField(help_text='Execution price in cents')),
                ('quantity', models.IntegerField(help_text='Number of contracts traded')),
                ('executed_at', models.DateTimeField(auto_now_add=True)),
                ('buy_order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='buy_trades', to='predictions.order')),
                ('buyer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='prediction_purchases', to=settings.AUTH_USER_MODEL)),
                ('market', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='trades', to='predictions.market')),
                ('sell_order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sell_trades', to='predictions.order')),
                ('seller', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='prediction_sales', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-executed_at'],
            },
        ),
        migrations.CreateModel(
            name='Transaction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('type', models.CharField(choices=[('deposit', 'Deposit'), ('withdrawal', 'Withdrawal'), ('trade_buy', 'Trade (Buy)'), ('trade_sell', 'Trade (Sell)'), ('settlement_win', 'Settlement (Win)'), ('settlement_loss', 'Settlement (Loss)'), ('order_reserve', 'Order Reserve'), ('order_release', 'Order Release'), ('refund', 'Refund')], max_length=20)),
                ('amount', models.DecimalField(decimal_places=2, help_text='Positive for credit, negative for debit', max_digits=12)),
                ('balance_before', models.DecimalField(decimal_places=2, max_digits=12)),
                ('balance_after', models.DecimalField(decimal_places=2, max_digits=12)),
                ('description', models.CharField(blank=True, max_length=500)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('market', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='predictions.market')),
                ('order', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='predictions.order')),
                ('trade', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='predictions.trade')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transactions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddIndex(
            model_name='event',
            index=models.Index(fields=['status', 'trading_ends'], name='predictions_status_8c5ef5_idx'),
        ),
        migrations.AddIndex(
            model_name='event',
            index=models.Index(fields=['category', 'status'], name='predictions_categor_e7394d_idx'),
        ),
        migrations.AddIndex(
            model_name='market',
            index=models.Index(fields=['status'], name='predictions_status_a77d43_idx'),
        ),
        migrations.AddIndex(
            model_name='market',
            index=models.Index(fields=['event', 'status'], name='predictions_event_i_c93a35_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='market',
            unique_together={('event', 'slug')},
        ),
        migrations.AddIndex(
            model_name='order',
            index=models.Index(fields=['market', 'status', 'side', 'contract_type', 'price'], name='predictions_market__304989_idx'),
        ),
        migrations.AddIndex(
            model_name='order',
            index=models.Index(fields=['user', 'status'], name='predictions_user_id_352c8b_idx'),
        ),
        migrations.AddIndex(
            model_name='order',
            index=models.Index(fields=['created_at'], name='predictions_created_7dabe2_idx'),
        ),
        migrations.AddIndex(
            model_name='position',
            index=models.Index(fields=['user'], name='predictions_user_id_fc0758_idx'),
        ),
        migrations.AddIndex(
            model_name='position',
            index=models.Index(fields=['market'], name='predictions_market__fe0c40_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='position',
            unique_together={('user', 'market')},
        ),
        migrations.AddIndex(
            model_name='trade',
            index=models.Index(fields=['market', 'executed_at'], name='predictions_market__e6dbea_idx'),
        ),
        migrations.AddIndex(
            model_name='trade',
            index=models.Index(fields=['buyer', 'executed_at'], name='predictions_buyer_i_cc35f0_idx'),
        ),
        migrations.AddIndex(
            model_name='trade',
            index=models.Index(fields=['seller', 'executed_at'], name='predictions_seller__c68fb2_idx'),
        ),
        migrations.AddIndex(
            model_name='transaction',
            index=models.Index(fields=['user', 'created_at'], name='predictions_user_id_13b072_idx'),
        ),
        migrations.AddIndex(
            model_name='transaction',
            index=models.Index(fields=['type', 'created_at'], name='predictions_type_50a295_idx'),
        ),
    ]
