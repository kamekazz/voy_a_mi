{% extends 'base.html' %}

{% block title %}{{ event.title }} - Voy a Mi{% endblock %}

{% block content %}

<!-- Navigation / Breadcrumb substitute -->
<div style="margin-bottom: 20px; font-size: 0.9rem;">
    <a href="{% url 'predictions:index' %}" class="text-secondary">Markets</a>
    <span class="text-tertiary mx-2">/</span>
    <a href="{% url 'predictions:event_list' %}" class="text-secondary">Events</a>
    <span class="text-tertiary mx-2">/</span>
    <span class="text-primary">{{ event.title|truncatewords:5 }}</span>
</div>

<!-- Event Hero Section -->
<div class="detail-hero">
    {% if event.image %}
    <img src="{{ event.image.url }}" alt="{{ event.title }}" 
         style="max-width: 100%; max-height: 300px; border-radius: 12px; margin-bottom: 24px; object-fit: cover; box-shadow: var(--shadow-md);">
    {% endif %}

    <h1 class="detail-title" style="font-size: 2rem; margin-bottom: 16px;">{{ event.title }}</h1>
    
    <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap;">
        <span class="tag active">{{ event.get_status_display }}</span>
        {% if event.category %}
        <span class="tag">{{ event.category.name }}</span>
        {% endif %}
        <span class="tag">{{ event.get_event_type_display }}</span>
    </div>

    <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 24px; max-width: 700px; margin-left: auto; margin-right: auto;">
        {{ event.description }}
    </p>

    <!-- Event Rules / Details Block -->
    <div style="background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; max-width: 600px; margin: 0 auto; text-align: left;">
        <div style="font-weight: 600; margin-bottom: 12px; font-size: 0.95rem; color: var(--text-primary);">
            <i class="bi bi-info-circle me-2"></i> Event Rules
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; font-size: 0.9rem;">
            <div>
                <span style="color: var(--text-tertiary); display: block; margin-bottom: 4px;">Trading Starts</span>
                <span style="color: var(--text-primary);">{{ event.trading_starts|date:"M d, Y H:i" }}</span>
            </div>
            <div>
                <span style="color: var(--text-tertiary); display: block; margin-bottom: 4px;">Trading Ends</span>
                <span style="color: var(--text-primary);">{{ event.trading_ends|date:"M d, Y H:i" }}</span>
            </div>
            {% if event.resolution_date %}
            <div>
                <span style="color: var(--text-tertiary); display: block; margin-bottom: 4px;">Resolution Date</span>
                <span style="color: var(--text-primary);">{{ event.resolution_date|date:"M d, Y" }}</span>
            </div>
            {% endif %}
            <div>
                <span style="color: var(--text-tertiary); display: block; margin-bottom: 4px;">Source</span>
                <span style="color: var(--text-primary);">{{ event.resolution_source|truncatewords:5 }}</span>
            </div>
        </div>
    </div>
</div>

<!-- Markets Section -->
<div class="mt-4">
    <div class="section-title">
        <i class="bi bi-bar-chart-line"></i> Markets ({{ markets.count }})
    </div>

    {% if markets %}
    <div class="markets-grid">
        {% for market in markets %}
        <a href="{% url 'predictions:market_detail' market.pk %}" class="market-card">
            <div class="market-header">
                {% if market.display_thumbnail %}
                <img src="{{ market.display_thumbnail.url }}" class="market-thumb" alt="Market">
                {% elif event.image %}
                <!-- Fallback to event image if market has no thumb -->
                <img src="{{ event.image.url }}" class="market-thumb" alt="Event">
                {% else %}
                <div class="market-thumb d-flex align-items-center justify-content-center" style="color: var(--text-tertiary);">
                    <i class="bi bi-graph-up"></i>
                </div>
                {% endif %}

                <div class="market-info">
                    <div class="market-title">{{ market.title }}</div>
                    <div class="market-meta">
                        <span>${{ market.total_volume|default:0 }} Vol</span>
                        {% if market.is_trading_active %}
                        <span class="text-green">• Active</span>
                        {% else %}
                        <span>• {{ market.get_status_display }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            {% if market.description %}
            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 12px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                {{ market.description }}
            </div>
            {% endif %}

            <div class="outcome-row" style="margin-top: auto;">
                <div class="outcome-btn outcome-yes">
                    <span>Yes</span>
                    <span>{{ market.last_yes_price }}c</span>
                </div>
                <div class="outcome-btn outcome-no">
                    <span>No</span>
                    <span>{{ market.last_no_price }}c</span>
                </div>
            </div>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; padding: 40px 20px; background: var(--bg-card); border-radius: 12px; border: 1px solid var(--border-color);">
        <i class="bi bi-inbox" style="font-size: 48px; color: var(--text-tertiary);"></i>
        <p style="margin-top: 16px; color: var(--text-secondary);">Markets for this event will be added soon.</p>
    </div>
    {% endif %}
</div>

<style>
    /* Inline helper for spacing not explicitly in CSS */
    .mx-2 { margin-left: 0.5rem; margin-right: 0.5rem; }
    .me-2 { margin-right: 0.5rem; }
</style>

{% endblock %}
