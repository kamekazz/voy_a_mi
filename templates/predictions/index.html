{% extends 'base.html' %}

{% block title %}Markets - Voy a Mi{% endblock %}

{% block content %}

<!-- Categories / Filters -->
{% if categories %}
<div class="tags">
    <a href="{% url 'predictions:index' %}" class="tag active">All</a>
    {% for category in categories %}
    <a href="{% url 'predictions:event_list' %}?category={{ category.slug }}" class="tag">
        {{ category.name }}
    </a>
    {% endfor %}
</div>
{% endif %}

<!-- Popular Markets Feed -->
{% if popular_markets %}
<div class="mb-4">
    <div class="section-title">
        <i class="bi bi-fire text-red"></i> Trending
    </div>

    {% for market in popular_markets %}
    <a href="{% url 'predictions:market_detail' market.pk %}" class="market-card">
        <div class="market-header">
            {% if market.display_thumbnail %}
            <img src="{{ market.display_thumbnail.url }}" class="market-thumb" alt="Market">
            {% elif market.event.thumbnail %}
            <img src="{{ market.event.thumbnail.url }}" class="market-thumb" alt="Event">
            {% else %}
            <div class="market-thumb d-flex align-items-center justify-content-center">
                <i class="bi bi-graph-up"></i>
            </div>
            {% endif %}

            <div class="market-info">
                <div class="market-title">{{ market.title }}</div>
                <div class="market-meta">
                    <span>${{ market.total_volume|default:0 }} Vol</span>
                    {% if market.is_trading_active %}
                    <span class="text-green">• Active</span>
                    {% else %}
                    <span>• {{ market.get_status_display }}</span>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="outcome-row">
            <div class="outcome-btn outcome-yes">
                <span>Yes</span>
                <span>{{ market.last_yes_price }}%</span>
            </div>
            <div class="outcome-btn outcome-no">
                <span>No</span>
                <span>{{ market.last_no_price }}%</span>
            </div>
        </div>
    </a>
    {% endfor %}
</div>
{% endif %}

<!-- Active Events (Grouped) -->
{% if active_events %}
<div class="mb-4">
    <div class="section-title">
        <i class="bi bi-clock-history"></i> New Events
    </div>

    {% for event in active_events %}
    <div class="market-card">
        <div class="market-header">
            {% if event.thumbnail %}
            <img src="{{ event.thumbnail.url }}" class="market-thumb" alt="Event">
            {% endif %}
            <div class="market-info">
                <div class="market-title">{{ event.title }}</div>
                <div class="market-meta">
                    {{ event.markets.count }} Market{{ event.markets.count|pluralize }}
                    • Ends {{ event.trading_ends|date:"M d" }}
                </div>
            </div>
        </div>
        <a href="{% url 'predictions:event_detail' event.slug %}" class="btn btn-outline w-100"
            style="margin-top: 4px;">
            View Markets
        </a>
    </div>
    {% endfor %}
</div>
{% endif %}

{% if not popular_markets and not active_events %}
<div style="text-align: center; padding: 40px 20px;">
    <i class="bi bi-inbox" style="font-size: 48px; color: var(--text-tertiary);"></i>
    <p style="margin-top: 16px; color: var(--text-secondary);">No active markets found.</p>
</div>
{% endif %}

{% endblock %}