{% extends 'base.html' %}
{% load static %}

{% block title %}Events - Voy a Mi{% endblock %}

{% block content %}
<!-- Top Controls / Filters -->
<div class="d-flex justify-between items-center mb-2" style="padding: 16px 0;">
    <!-- Horizontal Category Scroll -->
    <div class="tags" style="flex: 1; margin-bottom: 0;">
        <a href="?{% if selected_status %}status={{ selected_status }}&{% endif %}{% if selected_type %}type={{ selected_type }}&{% endif %}"
            class="tag {% if not selected_category %}active{% endif %} text-decoration-none">
            <i class="bi bi-grid"></i> All
        </a>
        {% for cat in categories %}
        <a href="?category={{ cat.slug }}{% if selected_status %}&status={{ selected_status }}{% endif %}{% if selected_type %}&type={{ selected_type }}{% endif %}"
            class="tag {% if selected_category == cat.slug %}active{% endif %} text-decoration-none">
            {% if cat.icon %}<i class="{{ cat.icon }}"></i> {% endif %}{{ cat.name }}
        </a>
        {% endfor %}
    </div>

    <!-- Simple Filter Dropdown (Hidden/Minimal for now or visible) -->
    <!-- For a cleaner look, we rely on topbar. If user needs specific status, we can add a filter button/modal.
         For this redesign, let's keep it clean. -->
</div>

<!-- Events Grid -->
{% if events %}
<div class="markets-grid">
    {% for event in events %}
    <a href="{% url 'predictions:event_detail' event.slug %}" class="market-card text-decoration-none">

        {% with market=event.markets.first %}
        <div class="market-header">
            <!-- Thumbnail -->
            {% if event.thumbnail %}
            <img src="{{ event.thumbnail.url }}" class="market-thumb" alt="{{ event.title }}">
            {% else %}
            <!-- Fallback Icon/Color -->
            <div class="market-thumb d-flex items-center justify-center"
                style="background: var(--bg-hover); color: var(--text-tertiary);">
                <i class="bi bi-graph-up"></i>
            </div>
            {% endif %}

            <!-- Title & Meta -->
            <div class="market-info">
                <div class="market-title">{{ event.title|truncatechars:60 }}</div>
                <div class="market-meta">
                    {% if market and market.volume_24h %}
                    <span class="text-success"><i class="bi bi-arrow-up-right"></i> ${{ market.volume_24h|floatformat:0
                        }} Vol</span>
                    <span>•</span>
                    {% endif %}
                    <span><i class="bi bi-clock"></i> {{ event.trading_ends|date:"M d" }}</span>
                </div>
            </div>
        </div>

        <!-- Price / Outcome Display -->
        {% if market %}
        <div class="outcome-bar mt-4">
            <!-- YES Price -->
            <div class="outcome-segment" style="flex: 1; justify-content: space-between;">
                <span style="color: var(--pm-green);">Yes</span>
                <span style="color: var(--text-primary);">{{ market.last_yes_price }}¢</span>
            </div>

            <!-- Divider -->
            <div style="width: 1px; height: 16px; background: var(--border-color);"></div>

            <!-- NO Price -->
            <div class="outcome-segment" style="flex: 1; justify-content: space-between;">
                <span style="color: var(--pm-red);">No</span>
                <span style="color: var(--text-primary);">{{ market.last_no_price }}¢</span>
            </div>
        </div>
        <!-- Probability Visual (Optional) -->
        <!-- <div style="height: 4px; display: flex; margin-top: -4px;">
                    <div style="width: {{ market.last_yes_price }}%; background: var(--pm-green); opacity: 0.5;"></div>
                    <div style="width: {{ market.last_no_price }}%; background: var(--pm-red); opacity: 0.5;"></div>
                </div> -->
        {% else %}
        <div class="outcome-bar mt-4 justify-center text-secondary">
            <small>No Active Markets</small>
        </div>
        {% endif %}
        {% endwith %}

    </a>
    {% endfor %}
</div>
{% else %}
<!-- Empty State -->
<div class="d-flex flex-column items-center justify-center py-5 text-center">
    <i class="bi bi-search text-tertiary mb-3" style="font-size: 4rem;"></i>
    <h3 class="text-primary mb-2">No Events Found</h3>
    <p class="text-secondary">Try selecting a different category.</p>
    <a href="{% url 'predictions:event_list' %}" class="btn btn-primary mt-4">View All Events</a>
</div>
{% endif %}
{% endblock %}